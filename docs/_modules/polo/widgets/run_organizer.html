

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>polo.widgets.run_organizer &mdash; Polo 0.1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/polo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Polo
          

          
            
            <img src="../../../_static/polo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQS.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">Userâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../video_guides.html">Video Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reports.html">Bug Reports and Suggestions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../polo.html">Polo Code Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Polo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../polo.html">polo</a> &raquo;</li>
        
      <li>polo.widgets.run_organizer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for polo.widgets.run_organizer</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ftplib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePosixPath</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">uic</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QGridLayout</span>

<span class="kn">from</span> <span class="nn">polo</span> <span class="kn">import</span> <span class="n">ICON_DICT</span><span class="p">,</span> <span class="n">IMAGE_SPECS</span><span class="p">,</span> <span class="n">SPEC_KEYS</span><span class="p">,</span> <span class="n">make_default_logger</span>
<span class="kn">from</span> <span class="nn">polo.crystallography.run</span> <span class="kn">import</span> <span class="n">HWIRun</span><span class="p">,</span> <span class="n">Run</span>
<span class="kn">from</span> <span class="nn">polo.designer.UI_run_organizer</span> <span class="kn">import</span> <span class="n">Ui_Form</span>
<span class="kn">from</span> <span class="nn">polo.threads.thread</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">polo.utils.dialog_utils</span> <span class="kn">import</span> <span class="n">make_message_box</span>
<span class="kn">from</span> <span class="nn">polo.utils.io_utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">polo.utils.unrar_utils</span> <span class="kn">import</span> <span class="n">test_for_working_unrar</span>
<span class="kn">from</span> <span class="nn">polo.windows.ftp_dialog</span> <span class="kn">import</span> <span class="n">FTPDialog</span>
<span class="kn">from</span> <span class="nn">polo.windows.run_importer</span> <span class="kn">import</span> <span class="n">RunImporterDialog</span>

<span class="c1"># run organizer should be the outer class and</span>
<span class="c1"># run tree should be the inner calss widget</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">make_default_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="RunOrganizer"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer">[docs]</a><span class="k">class</span> <span class="nc">RunOrganizer</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Widget for organizing and importing runs into Polo.</span>

<span class="sd">    :param parent: Parent widget, defaults to None</span>
<span class="sd">    :type parent: QWidget, optional</span>
<span class="sd">    :param auto_link_runs: If True runs are automatically</span>
<span class="sd">                            linked as they are loaded in, defaults to True</span>
<span class="sd">    :type auto_link_runs: bool, optional</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">opening_run</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">classify_run</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">ftp_download_status</span> <span class="o">=</span> <span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_link_runs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RunOrganizer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_Form</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_link_runs</span> <span class="o">=</span> <span class="n">auto_link_runs</span>  <span class="c1"># allow for turn off in settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_run</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shown_unrar_message</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># x of y downloads complete</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_been_opened</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shown_unrecognized_run_warning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_classification_request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">itemDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_opening_run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">opening_run</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_opening_run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">remove_run_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clear_current_run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">dropped_links_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_import_runs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">classify_sample_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_classify_multiple_runs</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Created </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get all runs currently listed in the :attr:`~ui.runTree`.</span>

<span class="sd">        :return: List of :class:`Run` objects</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">loaded_runs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">recent_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return recently accessed imports.</span>

<span class="sd">        :return: List of recently accessed imports</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span>
    
    <span class="nd">@recent_files</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">recent_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_file</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recent_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_file</span><span class="p">))</span>
    
<div class="viewcode-block" id="RunOrganizer.save_recent_import_paths"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.save_recent_import_paths">[docs]</a>    <span class="k">def</span> <span class="nf">save_recent_import_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Save the recently used import paths to the path specified by the</span>
<span class="sd">        :const:`~polo.RECENT_FILES` path. Polo will attempt to open and read</span>
<span class="sd">        this file the next time the program is run in order to allow users</span>
<span class="sd">        to open recently opened runs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_files</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RECENT_FILES</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">recent_files</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_files</span><span class="p">:</span>
                    <span class="n">recent_files</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunOrganizer._clear_current_run"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._clear_current_run">[docs]</a>    <span class="k">def</span> <span class="nf">_clear_current_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Clear out the current run from other widgets by emiting a</span>
<span class="sd">        :attr:`opening_run` signal with a list that does not contain</span>
<span class="sd">        a Run or HWIRun object.</span>

<span class="sd">        :param run_list: List of runs</span>
<span class="sd">        :type run_list: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">run_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opening_run</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span></div>

<div class="viewcode-block" id="RunOrganizer._handle_classification_request"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._handle_classification_request">[docs]</a>    <span class="k">def</span> <span class="nf">_handle_classification_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method to open a classification thread of the currently selected run.</span>
<span class="sd">        Calls  :meth:`~polo.widgets.run_organizer.RunOrganizer._open_classification_thread` to</span>
<span class="sd">        start the classification thread.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">selected_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">selected_run</span>
        <span class="k">if</span> <span class="n">selected_run</span><span class="p">:</span>

            <span class="n">classification_greenlight</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># check if run is an alternative spectrum, if true then warn the</span>
            <span class="c1"># user that MARCO has not been trained on this type of image</span>
            <span class="k">if</span> <span class="n">selected_run</span><span class="o">.</span><span class="n">image_spectrum</span> <span class="ow">and</span> <span class="n">selected_run</span><span class="o">.</span><span class="n">image_spectrum</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;visible&#39;</span><span class="p">:</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="n">make_message_box</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;WAIT! MARCO has not been trained on images that do not use standard visible light microscopy, like the images you have requested to classify. Therefore, image classifications may not be accurate. Press OK to continue classification despite having read this advice.&#39;</span><span class="p">,</span>
                    <span class="n">buttons</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                    <span class="n">classification_greenlight</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">selected_run</span><span class="o">.</span><span class="n">has_been_machine_classified</span><span class="p">:</span>
                <span class="c1"># ask user if they want to reclassify run if work has already</span>
                <span class="c1"># been done</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="n">make_message_box</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Selected run has already been classified. Would you like to classify again?&quot;</span><span class="p">,</span>
                    <span class="n">buttons</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
                <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
                        <span class="n">make_message_box</span><span class="p">(</span>
                            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Thank you human - Polo&quot;</span><span class="p">,</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">classification_greenlight</span> <span class="o">=</span> <span class="kc">False</span> 
            <span class="k">if</span> <span class="n">classification_greenlight</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open_classification_thread</span><span class="p">(</span><span class="n">selected_run</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Failed to open classification thread for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">selected_run</span><span class="p">))</span></div>

<div class="viewcode-block" id="RunOrganizer._handle_opening_run"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._handle_opening_run">[docs]</a>    <span class="k">def</span> <span class="nf">_handle_opening_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method that signal to other widgets that the current run should be opened</span>
<span class="sd">        for analysis and viewing by emiting the :attr:`opening_run` signal containing</span>
<span class="sd">        the selected run.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># get the selected item</span>
        <span class="n">selected_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">selected_run</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request open </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">selected_run</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">selected_run</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selected_run</span><span class="o">.</span><span class="n">run_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_been_opened</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selected_run</span><span class="p">,</span> <span class="n">HWIRun</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shown_unrecognized_run_warning</span><span class="p">:</span>
                    <span class="n">make_message_box</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Looks like you imported a non-HWI Run. For now optimization screening and plate view is disabled.&#39;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_shown_unrecognized_run_warning</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">selected_run</span><span class="p">,</span> <span class="s1">&#39;save_file_path&#39;</span><span class="p">):</span>
                    <span class="n">backup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_existing_backup</span><span class="p">(</span><span class="n">selected_run</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">backup</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">backup</span><span class="p">)):</span>
                        <span class="n">choice</span> <span class="o">=</span> <span class="n">make_message_box</span><span class="p">(</span>
                            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Found backed up classifications for this run.</span><span class="se">\</span>
<span class="s1">                                Would you like to use them?&#39;</span><span class="p">,</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                            <span class="n">reader</span> <span class="o">=</span> <span class="n">MsoReader</span><span class="p">(</span><span class="n">backup</span><span class="p">)</span>
                            <span class="n">classified_images</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">classify_images_from_mso_file</span><span class="p">(</span>
                                <span class="n">images</span><span class="o">=</span><span class="n">selected_run</span><span class="o">.</span><span class="n">images</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">classified_images</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                                <span class="n">selected_run</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">classified_images</span>
                                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Loaded classifications from backup.&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Failed to load classifications.&#39;</span>
                            <span class="n">make_message_box</span><span class="p">(</span>
                                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opening_run</span><span class="o">.</span><span class="n">emit</span><span class="p">([</span><span class="n">selected_run</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_been_opened</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">selected_run</span><span class="o">.</span><span class="n">run_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Could not open </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">selected_run</span><span class="p">))</span></div>

<div class="viewcode-block" id="RunOrganizer._open_classification_thread"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._open_classification_thread">[docs]</a>    <span class="k">def</span> <span class="nf">_open_classification_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method to create and run a classification thread which will run</span>
<span class="sd">        the MARCO model on all images in the run passed to `run` argument.</span>
<span class="sd">        Does not actually start the classification thread, just stores the</span>
<span class="sd">        newly created classification thread in `classification_thread`</span>
<span class="sd">        attribute.</span>

<span class="sd">        :param run: Run or HWIRun instance to run MARCO on</span>
<span class="sd">        :type run: Run or HWIRun</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Opening classification thread for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># reset the bar to 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span> <span class="o">=</span> <span class="n">ClassificationThread</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">change_value</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_progress_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">estimated_time</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_estimated_classification_time</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_classification_cleanup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">add_classified_run</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span></div>
        <span class="c1"># add return classification thread for easier access</span>
    
<div class="viewcode-block" id="RunOrganizer._classification_cleanup"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._classification_cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">_classification_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;&quot;Cleanup&quot; the UI after a classification thread has completed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Closed classification thread: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">exceptions</span><span class="p">:</span>
            <span class="n">make_message_box</span><span class="p">(</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Polo encountered an error while classifying your images </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">exceptions</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RunOrganizer._classify_multiple_runs"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._classify_multiple_runs">[docs]</a>    <span class="k">def</span> <span class="nf">_classify_multiple_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Run the MARCO model on a list of runs. Recursively creates</span>
<span class="sd">        :class:`ClassificationThreads` for each :class:`Run` until all</span>
<span class="sd">        :class:`Run` instances have been classified.</span>

<span class="sd">        :param runs: List of :class:`Run` instance to classify using MARCO  </span>
<span class="sd">        :type runs: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">recursive_classification_spawner</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
                        <span class="n">current_run</span> <span class="o">=</span> <span class="n">runs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_open_classification_thread</span><span class="p">(</span><span class="n">current_run</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                            <span class="n">recursive_classification_spawner</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">classification_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">make_message_box</span><span class="p">(</span>
                            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Completed all classifications&#39;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Caught </span><span class="si">{}</span><span class="s1"> at </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_multiple_runs</span><span class="p">))</span>
                    <span class="n">make_message_box</span><span class="p">(</span>
                        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Classification failed </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        
            <span class="n">recursive_classification_spawner</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="RunOrganizer.refresh_run_after_update"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.refresh_run_after_update">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_run_after_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">run</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">display_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">formated_name_to_name</span><span class="o">.</span><span class="n">items</span><span class="p">()}[</span><span class="n">run</span><span class="o">.</span><span class="n">run_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">remove_run</span><span class="p">(</span><span class="n">display_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">add_run_to_tree</span><span class="p">(</span><span class="n">run</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunOrganizer._set_progress_value"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._set_progress_value">[docs]</a>    <span class="k">def</span> <span class="nf">_set_progress_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private helper method to increment the classification</span>
<span class="sd">        progress bar.</span>

<span class="sd">        :param val: Value to set progress bar to</span>
<span class="sd">        :type val: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progressBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunOrganizer._set_estimated_classification_time"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._set_estimated_classification_time">[docs]</a>    <span class="k">def</span> <span class="nf">_set_estimated_classification_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">num_images_remain</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Display the estimated classification time to the user. Time remaining</span>
<span class="sd">        is calculated by multiplying the time it took to classify a representative</span>
<span class="sd">        image by the number of images that remain to be classified.</span>

<span class="sd">        :param time: Time to classify latest image</span>
<span class="sd">        :type time: int</span>
<span class="sd">        :param num_images_remain: Number of images that still require classification</span>
<span class="sd">        :type num_images_remain: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">*</span><span class="n">num_images_remain</span>
        <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">time_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> mins&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">/</span><span class="mi">60</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> secs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_32</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">time_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunOrganizer._add_runs_to_tree"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._add_runs_to_tree">[docs]</a>    <span class="k">def</span> <span class="nf">_add_runs_to_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method to add a set of runs to the runTree.</span>

<span class="sd">        :param runs: List of runs to add to the runTree</span>
<span class="sd">        :type runs: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sample_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">add_run_to_tree</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
            <span class="n">sample_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">loaded_runs</span><span class="p">[</span><span class="n">run</span><span class="o">.</span><span class="n">run_name</span><span class="p">]</span><span class="o">.</span><span class="n">sampleName</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="s1">&#39;save_file_path&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">save_file_path</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recent_files</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">save_file_path</span>
                <span class="c1"># imported from an xtal file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recent_files</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">image_dir</span>
            <span class="c1"># pulling run from runTree ensures it has a sample name if it</span>
            <span class="c1"># was added to the tree</span>
        <span class="c1"># link the runs together by sample</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">link_sample</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RunOrganizer._import_runs"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._import_runs">[docs]</a>    <span class="k">def</span> <span class="nf">_import_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Import :class:`Run` objects from a list of file and directory paths.</span>
<span class="sd">        Runs that are imported successfully will be added to the sample browser.</span>

<span class="sd">        :param file_paths: List of paths to files and directories to be imported</span>
<span class="sd">                            as runs</span>
<span class="sd">        :type file_paths: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">file_paths</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_paths</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">importer</span> <span class="o">=</span> <span class="n">RunImporter</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">create_import_thread</span><span class="p">()</span>
                
                <span class="k">def</span> <span class="nf">finished_import_thread</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="o">.</span><span class="n">result</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span> 
                        <span class="k">for</span> <span class="n">run_type</span> <span class="ow">in</span> <span class="n">RUN_TYPES</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">result</span> <span class="o">=</span> <span class="n">run_type</span><span class="o">.</span><span class="n">init_from_directory</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                                <span class="n">result</span><span class="o">.</span><span class="n">add_images_from_dir</span><span class="p">()</span>
                                <span class="k">break</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="k">continue</span>
                    
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Run</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_runs_to_tree</span><span class="p">([</span><span class="n">result</span><span class="p">])</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span> <span class="ow">and</span> <span class="n">file_paths</span><span class="p">:</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_paths</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">importer</span> <span class="o">=</span> <span class="n">RunImporter</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">create_import_thread</span><span class="p">()</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                            <span class="k">lambda</span><span class="p">:</span> <span class="n">finished_import_thread</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="k">lambda</span><span class="p">:</span> <span class="n">finished_import_thread</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">make_message_box</span><span class="p">(</span>
                        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Could not import </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Caught </span><span class="si">{}</span><span class="s1"> at </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_import_runs</span><span class="p">))</span>
                <span class="n">make_message_box</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Import failed </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="RunOrganizer._check_for_existing_backup"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._check_for_existing_backup">[docs]</a>    <span class="k">def</span> <span class="nf">_check_for_existing_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check the directory specified by the `BACKUP_DIR` constant for</span>
<span class="sd">        a backup mso file that matches the run passed through the `run`</span>
<span class="sd">        argument. Run&#39;s are matched to mso backups by their run name so it</span>
<span class="sd">        the user has renamed their run after the backup is saved it will not</span>
<span class="sd">        be found.</span>

<span class="sd">        See :meth:`~polo.widgets.run_organizer.RunOrganizer.backup_classifications`</span>
<span class="sd">        for details on how the mso files are written.</span>

<span class="sd">        :param run: Run to search for mso backup with</span>
<span class="sd">        :type run: HWIRun</span>
<span class="sd">        :return: Path to mso backup if one exists that matches the `run`, else</span>
<span class="sd">                return None</span>
<span class="sd">        :rtype: str or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">backups</span> <span class="o">=</span> <span class="n">list_dir_abs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">BACKUP_DIR</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">backups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">each_backup</span> <span class="ow">in</span> <span class="n">backups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">run</span><span class="o">.</span><span class="n">run_name</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">each_backup</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">each_backup</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="RunOrganizer.remove_run"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.remove_run">[docs]</a>    <span class="k">def</span> <span class="nf">remove_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span> 
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">formated_name_to_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">remove_run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="RunOrganizer.backup_classifications_on_thread"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.backup_classifications_on_thread">[docs]</a>    <span class="k">def</span> <span class="nf">backup_classifications_on_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Does the exact same thing as </span>
<span class="sd">        :meth:`~polo.widgets.run_organizer.RunOrganizer.backup_classifications` </span>
<span class="sd">        except excutes the job on a `QuickThread` instance to avoid slow</span>
<span class="sd">        computers complaining about the GUI being frozen. This has been</span>
<span class="sd">        especially prevelant on Windows machines.</span>

<span class="sd">        :param run: Run to save as mso file</span>
<span class="sd">        :type run: HWIRun</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">write_path</span> <span class="o">=</span> <span class="n">BACKUP_DIR</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">run_name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">finished_backup</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_thread</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">make_message_box</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Failed to backup </span><span class="si">{}</span><span class="s1"> human classifications to mso file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">run_name</span><span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="n">writer</span> <span class="o">=</span> <span class="n">MsoWriter</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">write_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_thread</span> <span class="o">=</span> <span class="n">QuickThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_classifications</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">finished_backup</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RunOrganizer.backup_classifications"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.backup_classifications">[docs]</a>    <span class="k">def</span> <span class="nf">backup_classifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write the human classifications of the images in the `run` argument</span>
<span class="sd">        to an mso file and store it in the directory specified by the</span>
<span class="sd">        :const:`BACKUP_DIR` constant. Does not store MARCO classifications because</span>
<span class="sd">        these can be much more easily recreated than human classifications.</span>
<span class="sd">        Additionally, when a run is loaded back in and a backup mso exists</span>
<span class="sd">        for it Polo assumes the classifications in that mso file are human</span>
<span class="sd">        classifications.</span>

<span class="sd">        Currently only :class:`HWIRun` instances can be written as mso files because of mso&#39;s</span>
<span class="sd">        integration with cocktail data and well assignments. Need a different</span>
<span class="sd">        format for non-HWI runs that would map filenames to classifications</span>
<span class="sd">        and ignore cocktail data / well assignments.</span>

<span class="sd">        :param run: :class:`HWIRun` to backup human classifications</span>
<span class="sd">        :type run: HWIRun</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">write_path</span> <span class="o">=</span> <span class="n">BACKUP_DIR</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">run_name</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">MsoWriter</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">write_path</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">write_mso_file</span><span class="p">(</span><span class="n">use_marco_classifications</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="RunOrganizer.import_saved_runs"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.import_saved_runs">[docs]</a>    <span class="k">def</span> <span class="nf">import_saved_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtal_files</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&#39;&#39;&#39;Import runs saved to xtal files.</span>

<span class="sd">        :param xtal_files: List of xtal files to import runs from, defaults to []</span>
<span class="sd">        :type xtal_files: list, optional</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">xtal_files</span><span class="p">:</span>
            <span class="n">xtal_dialog</span> <span class="o">=</span> <span class="n">RunImporter</span><span class="o">.</span><span class="n">make_xtal_file_dialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">xtal_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">xtal_files</span> <span class="o">=</span> <span class="n">xtal_dialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xtal_files</span><span class="p">:</span>  <span class="c1"># returned as a list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_runs</span><span class="p">(</span><span class="n">xtal_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="RunOrganizer.import_run_from_dialog"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.import_run_from_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">import_run_from_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Import a run from a file dialog.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">run_importer_dialog</span> <span class="o">=</span> <span class="n">RunImporterDialog</span><span class="p">(</span>
            <span class="n">current_run_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">runTree</span><span class="o">.</span><span class="n">current_run_names</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">run_importer_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_runs_to_tree</span><span class="p">(</span><span class="n">run_importer_dialog</span><span class="o">.</span><span class="n">import_candidates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Added </span><span class="si">{}</span><span class="s1"> runs from file dialog&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">run_importer_dialog</span><span class="o">.</span><span class="n">import_candidates</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">))</span></div>
        <span class="c1"># for run_name, run in run_importer_dialog.imported_runs.items():</span>
        <span class="c1">#     self._add_run_to_tree(run)</span>

<div class="viewcode-block" id="RunOrganizer.import_run_from_ftp"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer.import_run_from_ftp">[docs]</a>    <span class="k">def</span> <span class="nf">import_run_from_ftp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Import runs from an FTP server. If an FTP download thread is not already</span>
<span class="sd">        running creates an FTPDialog instances and opens it to the user. FTP functions</span>
<span class="sd">        are then taken over by the FTPDialog until it is closed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test_for_working_unrar</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shown_unrar_message</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">make_message_box</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;No working unrar installation found. If you download files via FTP you will have to unrar and import them manually&#39;</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shown_unrar_message</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ftp_download_thread&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">isRunning</span><span class="p">():</span>
            <span class="c1"># handle if download is already in progress</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">make_message_box</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;FTP download already in progress. </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1"> files downloaded.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span>
            <span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">ftp_browser</span> <span class="o">=</span> <span class="n">FTPDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">ftp_browser</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ftp_browser</span><span class="o">.</span><span class="n">ftp</span> <span class="ow">and</span> <span class="n">ftp_browser</span><span class="o">.</span><span class="n">download_files</span> <span class="ow">and</span> <span class="n">ftp_browser</span><span class="o">.</span><span class="n">save_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span> <span class="o">=</span> <span class="n">FTPDownloadThread</span><span class="p">(</span>
                <span class="n">ftp_browser</span><span class="o">.</span><span class="n">ftp</span><span class="p">,</span> <span class="n">ftp_browser</span><span class="o">.</span><span class="n">download_files</span><span class="p">,</span> <span class="n">ftp_browser</span><span class="o">.</span><span class="n">save_dir</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">download_path</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_ftp_download</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_finished_ftp_download</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_status</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ftp_browser</span><span class="o">.</span><span class="n">download_files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="RunOrganizer._handle_ftp_download"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._handle_ftp_download">[docs]</a>    <span class="k">def</span> <span class="nf">_handle_ftp_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method that handles when an individual file in the FTP</span>
<span class="sd">        download queue has finished downloading. Attempts to import the run</span>
<span class="sd">        by calling :meth:`import_runs` and then increments the FTP</span>
<span class="sd">        download counter by one.</span>

<span class="sd">        :param file_path: Path to file that was just downloaded</span>
<span class="sd">        :type file_path: str or Path</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_runs</span><span class="p">([</span><span class="n">file_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="RunOrganizer._finished_ftp_download"><a class="viewcode-back" href="../../../polo.widgets.html#polo.widgets.run_organizer.RunOrganizer._finished_ftp_download">[docs]</a>    <span class="k">def</span> <span class="nf">_finished_ftp_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private method that cleans up after all queued FTP downloads have</span>
<span class="sd">        been completed and shows a message box to the user to inform them of the</span>
<span class="sd">        status of their downloads.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_status</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_counter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># reset the counter</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">exceptions</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Failed to download all files from FTP server </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ftp_download_thread</span><span class="o">.</span><span class="n">exceptions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;All FTP downloads completed!&#39;</span>
            
        <span class="n">make_message_box</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div></div>

                    


</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ethan Holleman

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>